---
output: github_document
---

```{r setup, echo = FALSE}
library(data.table)
library(ggplot2)
```

# Description of the model

This is a variation of a SEIRD model, which includes hospitalizations. The specific features follow:

- Two types of network connections: families and bi-partite through entities.
- Individuals are clustered in groups of five.
- Each entity houses 100 individuals.
- Transmission can happen between family members or between entity members.
- At each step, the model draws 5 entity members per susceptible individual. This represents the chance of direct contact.
- Only infected non-hospitalized individuals can transmit the disease.

The current parameters are:

```c++
model.add_param(1.0/7.0, "Incubation period");
model.add_param(.1, "Hospitalization prob.");
model.add_param(.1, "Death prob.");
model.add_param(.5, "Infectiousness"); 
model.add_param(.25, "Infectiousness in entity");
model.add_param(1.0/7.0, "Prob. of Recovery");
```

# Running the model

```{bash}
./main.o
```

# Computing reproductive number

```{r repnum}
rt <- list.files("saves", pattern = "reproductive", full.names = TRUE)
rt <- lapply(seq_along(rt), \(i) {cbind(id = i, fread(rt[i]))}) |>
    rbindlist()

# Computing for each individual
rt <- rt[, .(rt = mean(rt)), by = c("id", "source_exposure_date")]
setorder(rt, source_exposure_date)

ggplot(rt, aes(x = source_exposure_date, y = rt)) +
    geom_jitter(alpha = .1) +
    geom_smooth() +
    lims(y = c(0, 5))
```

# Epi curves

```{r transitions}
epicurves <- list.files("saves", pattern = "hist", full.names = TRUE)
epicurves <- lapply(seq_along(epicurves), \(i) {
    cbind(id = i, fread(epicurves[i]))
}) |> rbindlist()

epicurves[status %in% c("Exposed", "Infected", "Hospitalized")] |>
    ggplot(aes(x = date, y = counts)) +
    geom_smooth(aes(colour = status)) +
    geom_jitter(aes(colour = status), alpha = .1)
```

```{r totals}
epicurves[!status %in% c("Exposed", "Infected", "Hospitalized")] |>
    ggplot(aes(x = date, y = counts)) +
    geom_smooth(aes(colour = status)) +
    geom_jitter(aes(colour = status), alpha = .1)
```

